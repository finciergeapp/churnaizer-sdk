<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Churnaizer SDK - Live Test</title>
  <style>
    body {
      font-family: sans-serif;
      max-width: 600px;
      margin: 40px auto;
      padding: 20px;
      border: 1px solid #ccc;
      border-radius: 12px;
      background: #f9f9f9;
    }
    input, button {
      display: block;
      margin: 10px 0;
      width: 100%;
      padding: 10px;
      font-size: 16px;
    }
    pre {
      background: #000;
      color: #0f0;
      padding: 15px;
      margin-top: 20px;
      white-space: pre-wrap;
    }
  </style>
</head>
<body>
  <h2>üîç Churnaizer SDK - Live Prediction Test</h2>
  <p>Test how the SDK tracks users and predicts churn using real AI:</p>

  <input id="user_id" placeholder="User ID" value="u123" />
  <input id="plan" placeholder="User Plan" value="free trial" />
  <input id="usage_score" type="number" placeholder="Usage Score (0-100)" value="45" />
  <input id="support_tickets" type="number" placeholder="Support Tickets" value="2" />
  <input id="email" type="email" placeholder="Email Address" value="founder@saas.com" />
  
  <button id="runPredictionBtn">üîç Run Churn Prediction</button>

  <pre id="predictionResult">Results will appear here...</pre>

  <script src="churnaizer-sdk.js"></script>
  
  <script>
    const CHURN_API_KEY = "cg_4a7ae37e08f0ac064f93b244487e19b8"; // Replace with test API key from Supabase

    function runManualTest() {
      document.getElementById("runPredictionBtn").addEventListener("click", function () {
        const userData = {
          user_id: document.getElementById("user_id").value,
          plan: document.getElementById("plan").value,
          usage_score: parseFloat(document.getElementById("usage_score").value),
          support_tickets: parseInt(document.getElementById("support_tickets").value),
          email: document.getElementById("email").value
        };

        window.Churnaizer.track(userData, CHURN_API_KEY, function (result, err) {
          const output = document.getElementById("predictionResult");

          if (err) {
            output.innerText = "‚ùå Error: " + err.message;
          } else {
            output.innerText = `\n‚úÖ Churn Score: ${result.churn_score}\nüìâ Reason: ${result.churn_reason}\nüí° Insight: ${result.insight}\nüß† Confidence Score: ${result.understanding}\n          `;
          }
        });
      });
    }

    function autoRunTest() {
      const mockUser = {
        user_id: 'u_test',
        email: 'test@example.com',
        plan: 'Pro',
        loginCount: 5,
        dashboardViews: 3,
        reportsGenerated: 1,
        settingsAccessed: 1
      };

      if (window.Churnaizer) {
        window.Churnaizer.track(
          mockUser,
          CHURN_API_KEY,
          function (result, error) {
            if (error) {
              console.error('SDK Test Failed:', error);
              window.parent.postMessage({ status: 'failed', error: error.message }, '*');
            } else {
              console.log('SDK Test Passed:', result);
              window.parent.postMessage({ status: 'passed', result }, '*');
            }
          }
        );
      } else {
        window.parent.postMessage({ status: 'failed', error: 'SDK not loaded' }, '*');
      }
    }

    window.addEventListener('DOMContentLoaded', function() {
      if (window !== window.parent) {
        // Running inside iframe ‚Üí auto-test mode
        autoRunTest();
        document.body.innerHTML = '<h2>Running SDK Test in iframe... Check console.</h2>'; // Optionally hide form
      } else {
        // Normal use ‚Üí show form
        runManualTest();
      }
    });
  </script>
</body>
</html>
